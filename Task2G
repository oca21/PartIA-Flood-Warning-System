# rank all stations based on risk level

import matplotlib.dates
import datetime
from floodsystem.stationdata import build_station_list, update_water_levels
from floodsystem.analysis import predict_future_level
from floodsystem.datafetcher import fetch_measure_levels

stations = build_station_list()
update_water_levels(stations)

def station_risk_level(station):
    try:
        dates, levels = fetch_measure_levels(
            station.measure_id, dt=datetime.timedelta(days=3)
        )
        level_tommorow = predict_future_level(dates, levels)[1]
        realtive_level_tommorow = (level_tommorow - station.typical_range[0]) / (
            station.typical_range[1] - station.typical_range[0]
        )
    except:
        print("something happened")
        realtive_level_tommorow = 1



for station in stations:
    print("Risk Level for", station.name, "is", station_risk_level(station))